
<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <title>Mini Forest</title>

     <!--Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        body {
            font-family: "Inter", sans-serif;
            margin: 0;
            padding: 0;
            background: #eef2f5;
            transition: background 0.3s, color 0.3s;
        }

        /* LOGIN SAYFASI */
        #loginPage {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            width: 100vw;
            position: fixed;
            top: 0;
            left: 0;
            background: #eef2f5;
            z-index: 9999;
        }

        .login-card {
            background: white;
            width: 350px;
            padding: 30px;
            border-radius: 14px;
            box-shadow: 0 4px 14px rgba(0,0,0,0.1);
            text-align: center;
        }

        .login-card input {
            width: 100%;
            padding: 12px;
            margin: 10px 10px;
            border-radius: 8px;
            border: 1px solid #ccc;
            box-sizing: border-box;   /* üìå ZORUNLU */
        }
        
        .login-btn {
            width: 100%;
            padding: 14px;
            background: #4caf50;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            color: white;
            cursor: pointer;
            transition: 0.25s;
            box-sizing: border-box;   /* üìå EKLENDƒ∞ */
        }
        
        

        .login-btn:hover {
            background: #3c8e41;
        }

        #errorMessage {
            color: red;
            margin-top: 10px;
        }

        /* APP SAYFASI GENEL */
        #appPage {
            display: none !important; /* ƒ∞lk a√ßƒ±lƒ±≈üta tamamen gizli */
            min-height: 100vh;
            width: 100vw;
            box-sizing: border-box;
        }

        #appPage.active {
            display: flex !important;
        }

        .app-wrapper {
            width: 100%;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 40px 20px;
            box-sizing: border-box;
        }

        .navbar {
            width: 780px;
            max-width: 100%;
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: #ffffff;
            padding: 12px 20px;
            border-radius: 14px;
            box-shadow: 0 4px 14px rgba(0,0,0,0.08);
            margin-bottom: 24px;
        }

        .navbar-left {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .navbar-title {
            font-size: 22px;
            font-weight: 600;
            color: #2e3a48;
        }

        .navbar-subtitle {
            font-size: 13px;
            color: #6b7280;
        }

        .navbar-right {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .navbar-user {
            font-size: 14px;
            color: #4b5563;
        }

        .btn-small {
            padding: 6px 12px;
            font-size: 13px;
            border-radius: 999px;
            border: none;
            cursor: pointer;
            background: #e53935;
            color: #ffffff;
            transition: 0.25s;
        }

        .btn-small:hover {
            background: #c62828;
        }

        .theme-toggle {
            background: #ffffff;
            border: 1px solid #ccc;
            color: #333;
            font-size: 18px;
            padding: 6px 10px;
            border-radius: 999px;
            cursor: pointer;
            box-shadow: 0 3px 8px rgba(0,0,0,0.1);
            transition: 0.25s;
        }

        .theme-toggle:hover {
            transform: scale(1.05);
        }

        .app-main {
            width: 780px;
            max-width: 100%;
            display: grid;
            grid-template-columns: minmax(0,1.1fr) minmax(0,1fr);
            gap: 24px;
        }

        .column {
            min-width: 0;
        }

        h1 {
            font-size: 26px;
            margin: 0 0 4px 0;
            color: #2e3a48;
        }

        h2 {
            margin-top: 0;
            margin-bottom: 10px;
            font-size: 20px;
            color: #4caf50;
        }

        .section-title {
            font-size: 18px;
            margin-bottom: 6px;
            color: #4caf50;
        }

        .card {
            background: white;
            padding: 20px 24px;
            border-radius: 14px;
            margin-top: 10px;
            box-shadow: 0 4px 14px rgba(0,0,0,0.08);
            transition: background 0.3s, color 0.3s, transform 0.2s;
        }

        .card:hover {
            transform: translateY(-1px);
        }

        input {
            padding: 8px 10px;
            border: 1px solid #ccc;
            border-radius: 8px;
            font-size: 15px;
        }

        button {
            padding: 8px 16px;
            font-size: 14px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            background: #4caf50;
            color: white;
            margin-left: 10px;
            transition: 0.25s;
        }

        button:hover {
            background: #3c8e41;
        }

        button.secondary {
            background: #e53935;
        }

        button.secondary:hover {
            background: #c62828;
        }

        ul {
            margin-top: 10px;
            padding-left: 18px;
        }

        li {
            background: #f3f4f6;
            margin: 6px 0;
            padding: 10px 14px;
            border-radius: 8px;
            font-size: 14px;
            transition: background 0.3s, color 0.3s;
        }

        .container-header {
            margin-bottom: 10px;
        }

        .forest-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, 50px);
            gap: 10px;
            margin-top: 15px;
        }

        .tree-item {
            width: 50px;
            height: 50px;
            background: #d4f8d4;
            border-radius: 10px;
            font-size: 28px;
            text-align: center;
            line-height: 50px;
            box-shadow: 0 3px 6px rgba(0,0,0,0.1);
            transition: transform 0.3s;
        }

        .tree-item:hover {
            transform: scale(1.15);
        }

        .quote-text {
            margin-top: 10px;
            font-size: 14px;
            font-style: italic;
            color: #555;
        }

        /* DARK MODE */
        body.dark-mode {
            background: #1d1f21 !important;
            color: #f0f0f0 !important;
        }

        body.dark-mode .login-card {
            background: #1e1e1e !important;
            color: #f0f0f0 !important;
        }

        body.dark-mode #loginPage {
            background: #111827 !important;
        }

        body.dark-mode h1,
        body.dark-mode h2,
        body.dark-mode label,
        body.dark-mode p {
            color: #eaeaea !important;
        }

        body.dark-mode .card {
            background: #2b2b2d !important;
            color: #f0f0f0 !important;
        }

        body.dark-mode li {
            background: #3a3a3c !important;
            color: #ffffff !important;
        }

        body.dark-mode button {
            background: #000000 !important;
            color: #ffffff !important;
        }

        body.dark-mode button.secondary {
            background: #c62828 !important;
        }

        body.dark-mode input,
        body.dark-mode select {
            background: #2a2a2a !important;
            color: #ffffff !important;
            border: 1px solid #555 !important;
        }

        body.dark-mode .navbar {
            background: #111827 !important;
            color: #f0f0f0 !important;
            box-shadow: 0 4px 14px rgba(0,0,0,0.6);
        }

        body.dark-mode .navbar-title {
            color: #e5e7eb !important;
        }

        body.dark-mode .navbar-subtitle {
            color: #9ca3af !important;
        }

        body.dark-mode .navbar-user {
            color: #e5e7eb !important;
        }

        body.dark-mode .theme-toggle {
            background: #333 !important;
            color: white !important;
            border: 1px solid #666 !important;
        }

        body.dark-mode .quote-text {
            color: #ddd !important;
        }

        body.dark-mode .tree-item {
            background: #2e7d32 !important;
            color: white !important;
        }

        @media (max-width: 768px) {
            .app-wrapper {
                padding: 20px 12px;
            }
            .navbar {
                padding: 10px 14px;
                flex-direction: column;
                align-items: flex-start;
                gap: 8px;
            }
            .app-main {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>

<!-- LOGIN SAYFASI -->
<div id="loginPage">
    <div class="login-card">
        <h2>üåø Mini Forest </h2>

        <input type="text" id="username" placeholder="Kullanƒ±cƒ± adƒ±">
        <input type="password" id="password" placeholder="≈ûifre">

        <button class="login-btn" onclick="login()">Giri≈ü Yap</button>

        <div id="errorMessage"></div>
    </div>
</div>
<!--  APP SAYFASI  -->
<div id="appPage">
    <div class="app-wrapper">

        <!--NAVBAR -->
        <header class="navbar">
            <div class="navbar-left">
                <span style="font-size: 24px;">üå≤</span>
                <div>
                    <div class="navbar-title">Mini Forest</div>
                    <div class="navbar-subtitle">Odak S√ºreni Ye≈üerten Uygulama</div>
                </div>
            </div>

            <div class="navbar-right">
                <span class="navbar-user" id="navbarUser"></span>
                <button id="themeToggle" class="theme-toggle">üåô</button>
                <button class="btn-small" onclick="logout()">√áƒ±kƒ±≈ü Yap</button>
            </div>
        </header>

    <!-- ƒ∞√áERƒ∞K -->
        <main class="app-main">
            <!-- SOL KOLON-->
            <section class="column">
                <div class="container-header">
                    <h2 class="section-title">Oturum ƒ∞≈ülemleri</h2>
                </div>

                <div class="card">
                    <h3 style="margin:0 0 10px 0; font-size:17px; color:#4caf50;">Yeni Odak Oturumu</h3>
                    <p style="margin:0 0 12px 0; font-size:14px; color:#6b7280;">
                        S√ºreyi se√ß, ba≈ülata tƒ±kla ve odak s√ºreni ormana d√∂n√º≈üt√ºr. üå±
                    </p>

                    <label>
                        S√ºre (dakika):
                        <input id="durationInput" type="number" value="25" min="1">
                    </label>

                    <div style="margin-top:10px;">
                        <button onclick="startSession()">Ba≈ülat</button>
                        <button class="secondary" onclick="finishSession()">Bitir</button>
                    </div>

                    <p style="margin-top:15px; font-size:14px;">
                        <strong>Aktif Oturum ID:</strong>
                        <span id="currentSessionId">Yok</span><br>
                        <strong>Geri Sayƒ±m:</strong>
                        <span id="timerDisplay">-</span>
                    </p>

                    <p id="motivationQuote" class="quote-text"></p>
                </div>

                <div class="card">
                    <h3 style="margin:0 0 10px 0; font-size:17px; color:#4caf50;">T√ºm Oturumlar</h3>
                    <div style="margin-bottom:8px;">
                        <button onclick="toggleSessions()">Gizle / G√∂ster</button>
                        <button class="secondary" onclick="clearSessions()">T√ºm√ºn√º Sil</button>
                    </div>
                    <ul id="sessionsList"></ul>
                </div>
            </section>

            <!-- SAƒû KOLON -->
            <section class="column">
                <div class="card">
                    <h3 style="margin:0 0 10px 0; font-size:17px; color:#4caf50;">Bug√ºnk√º Toplam S√ºre</h3>
                    <button onclick="loadToday()">Bug√ºn√º Getir</button>
                    <p id="todaySummary" style="margin-top:10px;">Hen√ºz y√ºklenmedi.</p>
                </div>

                <div class="card">
                    <h3 style="margin:0 0 10px 0; font-size:17px; color:#4caf50;">ƒ∞statistikler</h3>
                    <p style="font-size:14px; margin:0 0 10px 0; color:#6b7280;">
                        G√ºnlere g√∂re toplam odak s√ºren:
                    </p>
                    <canvas id="statsChart" height="150"></canvas>
                </div>

                <div class="card">
                    <h3 style="margin:0 0 10px 0; font-size:17px; color:#4caf50;">üå≥ Mini Orman</h3>
                    <p style="font-size:14px; margin:0 0 10px 0; color:#6b7280;">
                        Her tamamlanan odak oturumu otomatik olarak bir fidan ekler üå±
                    </p>

                    <label for="treeType" style="font-size:14px;">Aƒüa√ß t√ºr√º:</label>
                    <select id="treeType" style="margin-left:8px; padding:6px 8px; border-radius:8px;">
                        <option value="üå±">Fidan</option>
                        <option value="üå≥">√áƒ±nar</option>
                        <option value="üå≤">√áam</option>
                        <option value="üå¥">Palmiye</option>
                        <option value="üå∏">Kiraz</option>
                    </select>

                    <button class="secondary" style="margin-left:10px; margin-top:8px;" onclick="clearForest()">
                        Ormanƒ± Temizle
                    </button>

                    <div id="forestGrid" class="forest-grid"></div>
                </div>
            </section>
        </main>
    </div>
</div>

<!-- JAVASCRIPT  -->
<script>
const BASE_URL = "http://localhost:5097/Focus";

const forestGrid = document.getElementById("forestGrid");
const currentSessionSpan = document.getElementById("currentSessionId");

let currentSessionId = null;
let timerInterval = null;
let statsChart = null;
let remainingSeconds = 0;


// LOGIN SYSTEM 
function login() {
    const u = username.value.trim();
    const p = password.value.trim();

    if (u === "dilara" && p === "1234") {
        localStorage.setItem("loggedUser", u);

        loginPage.style.display = "none";
        appPage.classList.add("active");

        const userSpan = document.getElementById("navbarUser");
        if (userSpan) userSpan.textContent = "Ho≈ü geldin, " + u;

        renderForest();
        loadToday();
        loadSessions();
    } else {
        errorMessage.textContent = "Hatalƒ± giri≈ü!";
    }
}

function logout() {
    localStorage.removeItem("loggedUser");

    appPage.classList.remove("active");
    loginPage.style.display = "flex";

    timerDisplay.textContent = "-";
    currentSessionSpan.textContent = "Yok";
    sessionsList.innerHTML = "";
    forestGrid.innerHTML = "";

    if (timerInterval) clearInterval(timerInterval);
}

/* AUTO LOGIN */
if (localStorage.getItem("loggedUser")) {
    const u = localStorage.getItem("loggedUser");
    loginPage.style.display = "none";
    appPage.classList.add("active");
    const userSpan = document.getElementById("navbarUser");
    if (userSpan) userSpan.textContent = "Ho≈ü geldin, " + u;

    renderForest();
    loadToday();
    loadSessions();
}

/* MOTƒ∞VASYON MESAJLARI */
const quotes = [
    "K√º√ß√ºk adƒ±mlar b√ºy√ºk deƒüi≈üimler yaratƒ±r üåø",
    "Bug√ºn harika bir i≈ü √ßƒ±karƒ±yorsun ‚ú®",
    "Odaklandƒ±ƒüƒ±n her dakika seni ileri ta≈üƒ±r üå±",
    "Derin nefes al ve devam et üí´",
    "Bug√ºn, d√ºnk√º halinden bir tƒ±k daha ileridesin üåº",
    "Az ama d√ºzenli odak, mucizeler yaratƒ±r üåü"
];

function showQuote() {
    motivationQuote.textContent = quotes[Math.floor(Math.random()*quotes.length)];
}

/* SESSION + TIMER */
async function startSession() {
    const minutes = parseInt(durationInput.value);
    if (currentSessionId) {
        const onay = confirm("Devam eden bir oturum var. Bitirilsin mi?");
        if (!onay) return;
        await finishSession(true);
    }

    if (!minutes || minutes <= 0) {
        alert("Ge√ßerli bir s√ºre girin.");
        return;
    }

    try {
        const res = await fetch(BASE_URL + "/start", {
            method: "POST",
            headers: {"Content-Type":"application/json"},
            body: JSON.stringify({ durationMinutes: minutes })
        });

        const data = await res.json();
        if (data.success === false) {
            alert(data.message || "Oturum ba≈ülatƒ±lamadƒ±.");
            return;
        }

        currentSessionId = data.body.id;
        currentSessionSpan.textContent = currentSessionId;

        showQuote();
        startTimer(minutes * 60);
        loadSessions();
        loadToday();
    } catch (err) {
        alert("Hata: " + err);
    }
}

function startTimer(sec) {
    clearInterval(timerInterval);
    remainingSeconds = sec;
    updateTimerDisplay();

    timerInterval = setInterval(() => {
        remainingSeconds--;
        updateTimerDisplay();

        if (remainingSeconds <= 0) {
            clearInterval(timerInterval);
            if (currentSessionId) finishSession(true);
        }
    }, 1000);
}

function updateTimerDisplay() {
    if (remainingSeconds <= 0) {
        timerDisplay.textContent = "S√ºre bitti";
    } else {
        const m = Math.floor(remainingSeconds / 60);
        const s = remainingSeconds % 60;
        timerDisplay.textContent = `${m} dk ${s.toString().padStart(2, "0")} sn`;
    }
}

async function finishSession(auto=false) {
    if (!currentSessionId) {
        if (!auto) alert("Aktif oturum yok.");
        return;
    }

    try {
        const res = await fetch(BASE_URL + "/finish/" + currentSessionId, { method: "POST" });
        const data = await res.json();

        if (data.success === false) {
            if (!auto) alert(data.message || "Oturum bitirilemedi.");
            return;
        }

        clearInterval(timerInterval);
        remainingSeconds = 0;
        updateTimerDisplay();

        currentSessionId = null;
        currentSessionSpan.textContent = "Yok";

        addTree(treeType.value);
        renderForest();
        loadToday();
        loadSessions();
    } catch (err) {
        alert("Hata: " + err);
    }
}

/* TODAY */
async function loadToday() {
    try {
        const r = await fetch(BASE_URL + "/today");
        const d = await r.json();

        if (d.success === false) {
            todaySummary.textContent = d.message || "Veri alƒ±namadƒ±.";
            return;
        }

        todaySummary.textContent =
            d.body.date.substring(0,10) +
            " tarihinde " + d.body.totalMinutes + " dk odaklandƒ±n.";
    } catch (err) {
        todaySummary.textContent = "Hata: " + err;
    }
}

/* SESSIONS */
async function loadSessions() {
    try {
        const r = await fetch(BASE_URL);
        const d = await r.json();

        sessionsList.innerHTML = "";
        d.body.forEach(s => {
            const li = document.createElement("li");
            li.textContent =
                `ID: ${s.id} | S√ºre: ${s.durationMinutes} dk | ` +
                `Ba≈ülangƒ±√ß: ${new Date(s.startTime).toLocaleString()} ` +
                `| Durum: ${s.isCompleted ? "Tamamlandƒ±" : "Devam ediyor"}`;
            sessionsList.appendChild(li);
        });

        const active = d.body.find(s => !s.isCompleted);
        if (active) {
            currentSessionId = active.id;
            currentSessionSpan.textContent = currentSessionId;
        } else {
            currentSessionId = null;
            currentSessionSpan.textContent = "Yok";
        }

        drawChart(d.body);
    } catch (err) {
        alert("Hata: " + err);
    }
}

function toggleSessions() {
    sessionsList.style.display =
        sessionsList.style.display === "none" ? "block" : "none";
}

function clearSessions() {
    if (!confirm("T√ºm oturumlarƒ± listeden silmek istiyor musun? (Backend etkilenmez)")) return;
    sessionsList.innerHTML = "";
}

/* ORMAN */
function addTree(type) {
    const arr = JSON.parse(localStorage.getItem("forest") || "[]");
    arr.push(type);
    localStorage.setItem("forest", JSON.stringify(arr));
}

function renderForest() {
    const arr = JSON.parse(localStorage.getItem("forest") || "[]");
    forestGrid.innerHTML = "";
    arr.forEach(t => {
        const div = document.createElement("div");
        div.className = "tree-item";
        div.textContent = t;
        forestGrid.appendChild(div);
    });
}

function clearForest() {
    if (!confirm("Ormanƒ± tamamen silmek istiyor musun?")) return;
    localStorage.removeItem("forest");
    renderForest();
}

/* GRAFƒ∞K */
function drawChart(sessions) {
    const ctx = document.getElementById("statsChart");

    const dataByDate = {};
    sessions.forEach(s => {
        const k = new Date(s.startTime).toLocaleDateString("tr-TR");
        dataByDate[k] = (dataByDate[k] || 0) + s.durationMinutes;
    });

    const labels = Object.keys(dataByDate);
    const values = labels.map(x => dataByDate[x]);

    if (statsChart) statsChart.destroy();

    statsChart = new Chart(ctx, {
        type: "line",
        data: {
            labels,
            datasets: [{
                data: values,
                borderWidth: 2,
                tension: 0.3
            }]
        },
        options: {
            responsive: true,
            plugins: {
                legend: { display: false }
            },
            scales: {
                y: {
                    beginAtZero: true,
                    ticks: { stepSize: 10 }
                }
            }
        }
    });
}

/* TEMA */
const themeToggle = document.getElementById("themeToggle");

if (localStorage.getItem("theme") === "dark") {
    document.body.classList.add("dark-mode");
    if (themeToggle) themeToggle.textContent = "‚òÄÔ∏è";
}

if (themeToggle) {
    themeToggle.addEventListener("click", () => {
        document.body.classList.toggle("dark-mode");

        if (document.body.classList.contains("dark-mode")) {
            themeToggle.textContent = "‚òÄÔ∏è";
            localStorage.setItem("theme", "dark");
        } else {
            themeToggle.textContent = "üåô";
            localStorage.setItem("theme", "light");
        }
    });
}

/* SAYFA A√áILI≈ûI */
renderForest();

// HTML butonlarƒ±nƒ±n t√ºm fonksiyonlara eri≈üebilmesi i√ßin
window.startSession = startSession;
window.finishSession = finishSession;
window.toggleSessions = toggleSessions;
window.clearSessions = clearSessions;
window.loadToday = loadToday;
window.clearForest = clearForest;
window.login = login;
window.logout = logout;



</script>

</body>
</html>




